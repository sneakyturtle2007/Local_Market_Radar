<!DOCTYPE html>
<html lang="en">
    <head> 
        <meta charset="UTF-8">
        <link rel="stylesheet" href="ItemPage.css">
        <title>Home</title>
    </head>  
    
    <body>
        <!--HEADER-->
            <header>
                <h1 style="font-size: 56px; font-family: sans-serif;">Local Market Radar</h1>
                <button class = "signup">
                    <a href= "/Account">Sign up</a>
                </button>
                <hr>
            </header>
        <!--MAIN-->
            <main id = "main">
                <div class = "searchbar">  
                    <input type="text" id="search" placeholder="Search for items..">

                    <div class = "searchButton">
                        <p id="searchText">Search</button>
                    </div>
                </div>

                <div class = "searchSettings">
                    <ul>
                        <!--<li><button id="filterButton">Filter</button></li>-->
                    </ul>
                </div>
                
                <div id = "MainItemContainer">
                    <% items.forEach(function(item){ %> 
                        <div class = "itemcontainer">
                            <div class="itemcard">
                                <img src= <%= item.image %> alt="image">
                                <h5 class="name"> <%= item.name %> </h5>
                                <p class="price">Price: <%= item.price %>    |     Stock: <%= item.stock %>  </p>
                                <p class="description">Description: <%= item.description %> </p>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!--SEARCH SCRIPT -->

                    <script>
                        function displayItems(items){
                            var main = document.getElementById("MainItemContainer");
                            main.innerHTML = "";
                            
                            items.forEach(function(item){
                                var itemContainer = document.createElement("div");
                                itemContainer.className = "itemcontainer";

                                var itemCard = document.createElement("div");
                                itemCard.className = "itemcard";

                                var img = document.createElement("img");
                                img.src = item.image;
                                img.alt = "image";

                                var name = document.createElement("h5");
                                name.className = "name";
                                name.innerHTML = item.name;
                            
                                var price = document.createElement("p");
                                price.className = "price";
                                price.innerHTML = "Price: " + item.price + " | Stock: " + item.stock;

                                var description = document.createElement("p");
                                description.className = "description";
                                description.innerHTML = "Description: " + item.description;

                                itemCard.appendChild(img);
                                itemCard.appendChild(name);
                                itemCard.appendChild(price);
                                itemCard.appendChild(description);
                                itemContainer.appendChild(itemCard);
                                main.appendChild(itemContainer);
                            });
                            
                        }
                        document.addEventListener("keypress", async function(event) {
                            if (event.keyCode == 13) {
                                const search = document.getElementById("search").value;
                                const items = await fetch("/api/items?search=" + search).then(res => res.json()).catch(err => console.log(err) );
                                displayItems(items);
                            }
                          });
                        const searchButton = document.querySelector(".searchButton");
                        searchButton.addEventListener("click", async function(){
                            const search = document.getElementById("search").value;
                            const items = await fetch("/api/items?search=" + search).then(res => res.json()).catch(err => console.log(err) );
                            displayItems(items);
                        });
                    </script>

            </main>
        <!--FOOTER-->
            <footer id = "footer">
                <template id = "footerTemplate">
                    <div class = "footer">
                        <hr>
                        <p class="footer">Description: Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque voluptas temporibus quibusdam doloremque velit magnam autem modi ipsam nam maiores? Odio consectetur doloribus tenetur iste fugiat explicabo sequi amet distinctio! </p>
                    </div>
                </template>
            </footer>

    </body>
    
</html>